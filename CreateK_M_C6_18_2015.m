%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
function [K,M,C] = CreateK_M_C6_18_2015(SegNum,L,I_x,I_z,J,A,E,G,rho,etaG,etaE)
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% CreateK_M_C6_18_2015: Function for Dynamic TORNADO						
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% This function creates the stiffness, mass, and damping matrices
% Note: Only use for 2 segments or more and even Segment Number
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%	Author:	Nick Cramer, UCSC, Department of Computer Engineering			
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% CONTEXT:	Function for Dynamic TORNADO Aeroelastic Simulator					
% Called by:	---------FILL IN LATER----------												
% Calls:	MATLAB 5.2 std fcns
% Inputs:   SegNum - number of spanwise segments
%           L - array of spanwise lengths
%           I_x - array of x direction area moment of inertia for spanwise segments
%           I_z - array of z direction area moment of inertia for spanwise segments
%           J - array of rotational area moment of inertia for spanwise segments
%           A - array of cross section areas for spanwise segments
%           E - array of modulus of elasticity for spanwise segments
%           G - array of shear modulus for spanwise segments
%           rho - array of density for spanwise segments
%           etaG - array of shear damping for spanwise segments
%           etaE - array of elastic damping for spanwise segments
% Output:   K - stiffness matrix
%           M - mass matrix
%           C - damping matrix
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% Intialize final arrays and subarrays
K = zeros(5*(SegNum+1));
M = zeros(5*(SegNum+1));
C = zeros(5*(SegNum+1));
ksub1 = zeros(10);
msub1 = zeros(10);
csub1 = zeros(10);
ksub2 = zeros(10);
msub2 = zeros(10);
csub2 = zeros(10);

%Populate arrays
for i = 1:SegNum
    ksub1 =[12*E(i)/(L(i)^3)*I_z(i) 6*L(i)*E(i)/(L(i)^3)*I_z(i) 0 0 0 -12*E(i)/(L(i)^3)*I_z(i) 6*L(i)*E(i)/(L(i)^3)*I_z(i) 0 0 0;...
        6*L(i)*E(i)/(L(i)^3)*I_z(i) 4*L(i)^2*E(i)/(L(i)^3)*I_z(i) 0 0 0 -6*L(i)*E(i)/(L(i)^3)*I_z(i) 2*L(i)^2*E(i)/(L(i)^3)*I_z(i) 0 0 0;...
        0 0 12*I_x(i)*E(i)/(L(i)^3) 6*L(i)*E(i)/(L(i)^3)*I_x(i) 0 0 0 -12*I_x(i)*E(i)/(L(i)^3) 6*L(i)*E(i)/(L(i)^3)*I_x(i) 0;...
        0 0 6*L(i)*E(i)/(L(i)^3)*I_x(i) 4*L(i)^2*E(i)/(L(i)^3)*I_x(i) 0 0 0 -6*L(i)*I_x(i)*E(i)/(L(i)^3) 2*L(i)^2*I_x(i)*E(i)/(L(i)^3) 0;...
        0 0 0 0 G(i)*J(i)/(2*L(i)) 0 0 0 0 -G(i)*J(i)/(2*L(i));...
        -12*I_z(i)*E(i)/(L(i)^3) -6*L(i)*I_z(i)*E(i)/(L(i)^3) 0 0 0 12*I_z(i)*E(i)/(L(i)^3) -6*L(i)*I_z(i)*E(i)/(L(i)^3) 0 0 0;...
        6*L(i)*I_z(i)*E(i)/(L(i)^3) 2*L(i)^2*I_z(i)*E(i)/(L(i)^3) 0 0 0 -6*L(i)*I_z(i)*E(i)/(L(i)^3) 4*L(i)^2*I_z(i)*E(i)/(L(i)^3) 0 0 0;...
        0 0 -12*I_x(i)*E(i)/(L(i)^3) -6*L(i)*I_x(i)*E(i)/(L(i)^3) 0 0 0 12*I_x(i)*E(i)/(L(i)^3) -6*L(i)*I_x(i)*E(i)/(L(i)^3) 0;...
        0 0 6*L(i)*I_x(i)*E(i)/(L(i)^3) 2*L(i)^2*I_x(i)*E(i)/(L(i)^3) 0 0 0 -6*L(i)*I_x(i)*E(i)/(L(i)^3) 4*L(i)^2*I_x(i)*E(i)/(L(i)^3) 0;...
        0 0 0 0 -G(i)*J(i)/(2*L(i)) 0 0 0 0 G(i)*J(i)/(2*L(i));
        ];
    csub1 = [12*etaE(i)/(L(i)^3)*I_z(i) 6*etaE(i)/(L(i)^3)*L(i)*I_z(i) 0 0 0 -12*etaE(i)/(L(i)^3)*I_z(i) 6*etaE(i)/(L(i)^3)*L(i)*I_z(i) 0 0 0;...
        6*L(i)*etaE(i)/(L(i)^3)*I_z(i) 4*L(i)^2*etaE(i)/(L(i)^3)*I_z(i) 0 0 0 -6*L(i)*etaE(i)/(L(i)^3)*I_z(i) 2*L(i)^2*etaE(i)/(L(i)^3)*I_z(i) 0 0 0;...
        0 0 12*etaE(i)/(L(i)^3)*I_x(i) 6*etaE(i)/(L(i)^3)*L(i)*I_x(i) 0 0 0 -12*etaE(i)/(L(i)^3)*I_x(i) 6*etaE(i)/(L(i)^3)*L(i)*I_x(i) 0;...
        0 0 6*L(i)*etaE(i)/(L(i)^3)*I_x(i) 4*L(i)^2*etaE(i)/(L(i)^3)*I_x(i) 0 0 0 -6*L(i)*etaE(i)/(L(i)^3)*I_x(i) 2*L(i)^2*etaE(i)/(L(i)^3)*I_x(i) 0;...
        0 0 0 0 etaG(i)*J(i)/(2*L(i)) 0 0 0 0 -etaG(i)*J(i)/(2*L(i));...
        -12*I_z(i)*etaE(i)/(L(i)^3) -6*L(i)*I_z(i)*etaE(i)/(L(i)^3) 0 0 0 12*I_z(i)*etaE(i)/(L(i)^3) -6*L(i)*etaE(i)/(L(i)^3)*I_z(i) 0 0 0;...
        6*L(i)*I_z(i)*etaE(i)/(L(i)^3) 2*L(i)^2*I_z(i)*etaE(i)/(L(i)^3) 0 0 0 -6*L(i)*I_z(i)*etaE(i)/(L(i)^3) 4*L(i)^2*I_z(i)*etaE(i)/(L(i)^3) 0 0 0;...
        0 0 -12*I_x(i)*etaE(i)/(L(i)^3) -6*L(i)*I_x(i)*etaE(i)/(L(i)^3) 0 0 0 12*I_x(i)*etaE(i)/(L(i)^3) -6*L(i)*I_x(i)*etaE(i)/(L(i)^3) 0;...
        0 0 6*L(i)*etaE(i)/(L(i)^3)*I_x(i) 2*L(i)^2*etaE(i)/(L(i)^3)*I_x(i) 0 0 0 -6*L(i)*etaE(i)/(L(i)^3)*I_x(i) 4*L(i)^2*etaE(i)/(L(i)^3)*I_x(i) 0;...
        0 0 0 0 -etaG(i)*J(i)/(2*L(i)) 0 0 0 0 etaG(i)*J(i)/(2*L(i));
        ];
    msub1 = rho(i)*A(i)*L(i)/420*[156 22*L(i) 0 0 0 54 -13*L(i) 0 0 0;...
        22*L(i) 4*L(i)^2 0 0 0 13*L(i) -3*L(i)^2 0 0 0;...
        0 0 156 22*L(i) 0 0 0 54 -13*L(i) 0;...
        0 0 22*L(i) 4*L(i)^2 0 0 0 13*L(i) -3*L(i)^2 0;...
        0 0 0 0 420/L(i)^2 0 0 0 0 -420/L(i)^2;...
        54 13*L(i) 0 0 0 156 -22*L(i) 0 0 0;...
        -13*L(i) -3*L(i)^2 0 0 0 -22 4*L(i)^2 0 0 0;...
        0 0 54 13*L(i) 0 0 0 156 -22*L(i) 0;...
        0 0 -13*L(i) -3*L(i)^2 0 0 0 -22 4*L(i)^2 0;...
        0 0 0 0 -420/L(i)^2 0 0 0 0 420/L(i)^2];

    K(5*(i-1)+1:5*(i-1)+10,5*(i-1)+1:5*(i-1)+10)=...
        K(5*(i-1)+1:5*(i-1)+10,5*(i-1)+1:5*(i-1)+10)+ksub1;
    C(5*(i-1)+1:5*(i-1)+10,5*(i-1)+1:5*(i-1)+10)=...
        C(5*(i-1)+1:5*(i-1)+10,5*(i-1)+1:5*(i-1)+10)+csub1;
    M(5*(i-1)+1:5*(i-1)+10,5*(i-1)+1:5*(i-1)+10) =...
        M(5*(i-1)+1:5*(i-1)+10,5*(i-1)+1:5*(i-1)+10)+msub1;
end